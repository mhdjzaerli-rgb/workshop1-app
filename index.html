<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬ÙØ¨ÙØ¨ â€“ Ø§Ù„ÙˆØ±Ø´Ø©</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#3742fa">

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{
  font-family: Arial;
  direction: rtl;
  background:#eef1f5;
  margin:0;
  transition:.3s;
}
.app{padding:15px}
h2{text-align:center}

select,input,button{
  width:100%;
  padding:8px;
  margin:5px 0;
}

button.green{background:#2ed573;color:white;border:none}
button.blue{background:#3742fa;color:white;border:none}
button.gray{background:#57606f;color:white;border:none}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  font-size:14px;
  text-align:center;
}
th{background:#f1f2f6}

.action{cursor:pointer;color:white;padding:3px 6px;border-radius:4px}
.edit{background:orange}
.delete{background:red}

.report{
  margin-top:10px;
  background:#f8f9fa;
  padding:10px;
  border-radius:8px;
}

/* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
body.dark{background:#1e1e1e;color:#eee}
body.dark th{background:#333;color:#eee}
body.dark td{background:#2a2a2a;color:#eee}
body.dark input,body.dark select{
  background:#333;color:#fff;border:1px solid #555
}
body.dark .report{background:#333}

.footer{
  margin-top:15px;
  padding-top:10px;
  border-top:2px dashed #ccc;
}
</style>
</head>

<body>

<div class="app">

<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬ÙØ¨ÙØ¨</h2>

<select id="employee"></select>
<select id="model"></select>
<select id="size">
<option>M</option><option>L</option><option>XL</option>
<option>XXL</option><option>3XL</option>
</select>
<select id="color"></select>

<input id="qty" type="number" placeholder="Ø§Ù„Ø¹Ø¯Ø¯">

<button class="green" onclick="addOrUpdate()">Ø­ÙØ¸</button>

<hr>

<h3>ğŸ“… ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</h3>
<input type="month" id="monthPicker">
<button class="blue" onclick="generateReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
<button class="blue" onclick="exportExcel()">ØªØµØ¯ÙŠØ± Excel</button>

<table>
<thead>
<tr>
<th>Ø§Ù„Ù…ÙˆØ¸ÙØ©</th><th>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</th><th>Ø§Ù„Ù…Ù‚Ø§Ø³</th>
<th>Ø§Ù„Ù„ÙˆÙ†</th><th>Ø§Ù„Ø¹Ø¯Ø¯</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>

<div class="report" id="report"></div>

<div class="footer">
<h3>â• Ø¥Ø¶Ø§ÙØ§Øª</h3>

<input id="newEmployee" placeholder="Ù…ÙˆØ¸ÙØ© Ø¬Ø¯ÙŠØ¯Ø©">
<button class="gray" onclick="addEmployee()">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸ÙØ©</button>

<input id="newModel" placeholder="Ù…ÙˆØ¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯">
<button class="gray" onclick="addModel()">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„</button>

<input id="newColor" placeholder="Ù„ÙˆÙ† Ø¬Ø¯ÙŠØ¯">
<button class="gray" onclick="addColor()">Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ†</button>

<button class="blue" onclick="toggleDark()">ğŸŒ™ ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ</button>
</div>

</div>

<script>
let employees=JSON.parse(localStorage.getItem("employees"))||["Ù†Ø§Ø±ÙŠÙ…Ø§Ù†","Ù…ÙŠÙ†Ø§","Ø´Ø§Ù‡ÙŠÙ†Ø§Ø²","Ø³ÙˆÙŠÙƒÙŠ"];
let models=JSON.parse(localStorage.getItem("models"))||["ÙƒÙ†ÙØ©","Ù…Ø¹ÙŠÙ†Ø§Øª","Ù…Ø±Ø¨Ø¹Ø§Øª","ØºØ§Ù„ÙˆÙ†","ÙƒÙˆÙ„ÙÙŠ"];
let colors=JSON.parse(localStorage.getItem("colors"))||["Ø§Ø­Ù…Ø±","Ù…ÙˆÙ","Ù…ÙŠÙ„ÙƒØ§","Ø²ÙŠØªÙŠ","Ø¨Ù„ÙˆÙ†ÙˆÙŠ","ØºØ±ÙˆÙ†Ø§","Ø¨ÙŠØ³ØªØ§Ø´","ÙÙŠØ±Ø¯Ùˆ","ØªØ±ÙƒÙˆØ§Ø²","Ø¨ÙŠØ¬","Ø²Ù‡Ø±","Ø§Ø²Ø±Ù‚"];
let records=JSON.parse(localStorage.getItem("records"))||[];
let editIndex=null;

function save(){
  localStorage.setItem("employees",JSON.stringify(employees));
  localStorage.setItem("models",JSON.stringify(models));
  localStorage.setItem("colors",JSON.stringify(colors));
  localStorage.setItem("records",JSON.stringify(records));
}

function fill(id,list){
  let s=document.getElementById(id); s.innerHTML="";
  list.forEach(v=>s.innerHTML+=`<option>${v}</option>`);
}

function render(){
  fill("employee",employees);
  fill("model",models);
  fill("color",colors);
  table.innerHTML="";
  records.forEach((r,i)=>{
    table.innerHTML+=`
    <tr>
    <td>${r.employee}</td>
    <td>${r.model}</td>
    <td>${r.size}</td>
    <td>${r.color}</td>
    <td>${r.qty}</td>
    <td>${r.date}</td>
    <td>
      <span class="action edit" onclick="edit(${i})">âœï¸</span>
      <span class="action delete" onclick="del(${i})">ğŸ—‘</span>
    </td>
    </tr>`;
  });
  save();
}

function addOrUpdate(){
  let r={
    employee:employee.value,
    model:model.value,
    size:size.value,
    color:color.value,
    qty:+qty.value,
    date:new Date().toISOString().slice(0,10)
  };
  editIndex==null?records.push(r):records[editIndex]=r;
  editIndex=null; qty.value="";
  render();
}

function edit(i){
  let r=records[i];
  employee.value=r.employee;
  model.value=r.model;
  size.value=r.size;
  color.value=r.color;
  qty.value=r.qty;
  editIndex=i;
}

function del(i){
  if(confirm("Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ØŸ")){
    records.splice(i,1);
    render();
  }
}

function addEmployee(){if(newEmployee.value){employees.push(newEmployee.value);newEmployee.value="";render();}}
function addModel(){if(newModel.value){models.push(newModel.value);newModel.value="";render();}}
function addColor(){if(newColor.value){colors.push(newColor.value);newColor.value="";render();}}

function generateReport(){
  let m=monthPicker.value;
  if(!m)return;
  let totals={};
  records.filter(r=>r.date.startsWith(m))
    .forEach(r=>totals[r.employee]=(totals[r.employee]||0)+r.qty);
  let out="<b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ:</b><br>";
  for(let e in totals) out+=`ğŸ‘© ${e}: ${totals[e]}<br>`;
  report.innerHTML=out;
}

function exportExcel(){
  let wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(records),"Ø§Ù„Ø³Ø¬Ù„Ø§Øª");
  XLSX.writeFile(wb,"workshop.xlsx");
}

/* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true")document.body.classList.add("dark");

/* ØªØ³Ø¬ÙŠÙ„ Service Worker */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}

render();
</script>

</body>
</html>