<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <link rel="manifest" href="manifest.json">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#2c1a0e">
<title>ÙˆØ±Ø´Ø© Ø§Ù„Ø®ÙŠØ§Ø·Ø©</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;900&family=Amiri:wght@400;700&display=swap');

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}

:root{
  --bg:#fdf8f2;--bg2:#f0e8d8;--surface:#fff;--surface2:#faf5ee;
  --border:#e2d0b8;--border2:#c8a87a;
  --ink:#2c1a0e;--ink2:#6b4c33;--ink3:#a07850;
  --gold:#b8892a;--gold2:#d4a843;--gold-light:#f5e6c0;
  --teal:#1a6b5c;--teal2:#1f8470;--teal-light:#d8f0ea;
  --rose:#8b2a3a;--rose-light:#f5dde1;
  --blue:#1a4a8b;--purple:#5a2a8b;
  --nav-h:64px;
  --top-h:60px;
  --safe-b:env(safe-area-inset-bottom,0px);
}

html,body{height:100%;overflow:hidden;}
body{font-family:'Cairo',sans-serif;background:var(--bg);color:var(--ink);display:flex;flex-direction:column;}

/* â•â• TOP BAR â•â• */
.topbar{
  height:var(--top-h);
  background:linear-gradient(135deg,#2c1a0e,#4a2c14);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 1rem;
  border-bottom:2px solid var(--gold);
  flex-shrink:0;
  position:relative;z-index:50;
  box-shadow:0 2px 12px rgba(0,0,0,.4);
}
.topbar-brand{display:flex;align-items:center;gap:.6rem;}
.topbar-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--gold),var(--gold2));border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;}
.topbar-title{font-family:'Amiri',serif;font-size:1.1rem;font-weight:700;color:#f5e6c0;}
.topbar-sub{font-size:.6rem;color:var(--gold2);line-height:1;}
.topbar-btn{width:36px;height:36px;border:none;background:rgba(255,255,255,.1);border-radius:9px;color:#f5e6c0;font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .15s;}
.topbar-btn:active{background:rgba(255,255,255,.25);}

/* â•â• SCROLL AREA â•â• */
.scroll-area{
  flex:1;overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  padding-bottom:calc(var(--nav-h) + var(--safe-b) + .5rem);
}

/* â•â• BOTTOM NAV â•â• */
.bottom-nav{
  height:calc(var(--nav-h) + var(--safe-b));
  padding-bottom:var(--safe-b);
  background:var(--surface);
  border-top:1px solid var(--border);
  display:flex;
  flex-shrink:0;
  box-shadow:0 -2px 15px rgba(44,26,14,.12);
  position:relative;z-index:50;
}
.nav-btn{
  flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:.2rem;border:none;background:transparent;
  font-family:'Cairo',sans-serif;font-size:.62rem;font-weight:600;
  color:var(--ink3);cursor:pointer;transition:color .2s;
  padding:.4rem 0;
}
.nav-btn .nav-icon{font-size:1.35rem;transition:transform .2s;}
.nav-btn.active{color:var(--gold);}
.nav-btn.active .nav-icon{transform:scale(1.15);}
.nav-btn:active .nav-icon{transform:scale(.9);}

/* â•â• PAGES â•â• */
.page{display:none;animation:fadeIn .2s ease;}
.page.active{display:block;}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* â•â• FAB â•â• */
.fab{
  position:fixed;
  left:50%;transform:translateX(-50%);
  bottom:calc(var(--nav-h) + var(--safe-b) + .8rem);
  z-index:40;
  width:56px;height:56px;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  border:none;border-radius:50%;
  font-size:1.6rem;color:white;
  box-shadow:0 4px 20px rgba(184,137,42,.5);
  cursor:pointer;transition:transform .2s,box-shadow .2s;
  display:flex;align-items:center;justify-content:center;
}
.fab:active{transform:translateX(-50%) scale(.92);}

/* â•â• SECTION HEADER â•â• */
.sec-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:.75rem 1rem .5rem;
}
.sec-title{font-family:'Amiri',serif;font-size:1rem;font-weight:700;color:var(--ink);display:flex;align-items:center;gap:.4rem;}
.sec-count{font-size:.7rem;color:var(--ink3);background:var(--bg2);padding:.15rem .5rem;border-radius:12px;}

/* â•â• MINI STATS ROW â•â• */
.mini-stats{display:flex;gap:.6rem;padding:.4rem 1rem .7rem;overflow-x:auto;scrollbar-width:none;}
.mini-stats::-webkit-scrollbar{display:none;}
.mini-stat{
  background:var(--surface);border:1px solid var(--border);border-radius:12px;
  padding:.5rem .85rem;display:flex;align-items:center;gap:.5rem;flex-shrink:0;
  box-shadow:0 1px 6px rgba(44,26,14,.06);
}
.mini-stat-icon{font-size:1.1rem;}
.mini-stat-val{font-size:1rem;font-weight:800;color:var(--ink);}
.mini-stat-lbl{font-size:.6rem;color:var(--ink3);}

/* â•â• RECORD CARDS â•â• */
.cards-list{display:flex;flex-direction:column;gap:.65rem;padding:0 .85rem .5rem;}
.rec-card{
  background:var(--surface);border:1px solid var(--border);border-radius:14px;
  padding:.85rem;box-shadow:0 1px 8px rgba(44,26,14,.06);
  animation:cardIn .25s ease;
}
@keyframes cardIn{from{opacity:0;transform:scale(.97)}to{opacity:1;transform:scale(1)}}
.rec-card-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:.55rem;}
.rec-worker{display:flex;align-items:center;gap:.5rem;}
.worker-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold2));display:flex;align-items:center;justify-content:center;font-size:.82rem;font-weight:700;color:white;flex-shrink:0;}
.worker-name{font-weight:700;font-size:.92rem;}
.worker-date{font-size:.65rem;color:var(--ink3);}
.rec-qty{font-size:1.6rem;font-weight:900;color:var(--teal);line-height:1;}
.rec-qty-lbl{font-size:.6rem;color:var(--ink3);text-align:center;}
.rec-card-tags{display:flex;gap:.4rem;flex-wrap:wrap;margin-bottom:.6rem;}
.tag{display:inline-flex;align-items:center;gap:.3rem;padding:.2rem .6rem;border-radius:20px;font-size:.7rem;font-weight:700;}
.tag-model{background:var(--gold-light);color:var(--gold);border:1px solid rgba(184,137,42,.25);}
.tag-size{background:var(--teal-light);color:var(--teal);border:1px solid rgba(26,107,92,.25);}
.tag-color{border:1px solid rgba(0,0,0,.1);}
.cdot-sm{width:10px;height:10px;border-radius:50%;border:1px solid rgba(0,0,0,.15);flex-shrink:0;}
.rec-note{font-size:.73rem;color:var(--ink3);background:var(--bg2);border-radius:7px;padding:.3rem .6rem;margin-bottom:.6rem;}
.rec-actions{display:flex;gap:.5rem;}
.act-btn{flex:1;padding:.45rem;border:none;border-radius:9px;font-family:'Cairo',sans-serif;font-size:.75rem;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:.3rem;transition:all .15s;}
.act-edit{background:var(--gold-light);color:var(--gold);border:1px solid rgba(184,137,42,.3);}
.act-edit:active{background:var(--gold2);color:white;}
.act-del{background:var(--rose-light);color:var(--rose);border:1px solid rgba(139,42,58,.2);}
.act-del:active{background:var(--rose);color:white;}

/* â•â• EMPTY STATE â•â• */
.empty{text-align:center;padding:3rem 2rem;color:var(--ink3);}
.empty-icon{font-size:3rem;margin-bottom:.5rem;opacity:.35;}
.empty p{font-size:.88rem;}

/* â•â• FILTER BAR â•â• */
.filter-scroll{display:flex;gap:.5rem;padding:.5rem 1rem;overflow-x:auto;scrollbar-width:none;}
.filter-scroll::-webkit-scrollbar{display:none;}
.filter-chip{
  display:flex;align-items:center;gap:.35rem;padding:.38rem .8rem;
  background:var(--surface);border:1px solid var(--border2);border-radius:20px;
  font-family:'Cairo',sans-serif;font-size:.75rem;font-weight:600;color:var(--ink2);
  cursor:pointer;white-space:nowrap;flex-shrink:0;transition:all .15s;
}
.filter-chip.active-filter{background:var(--gold);color:white;border-color:var(--gold);}
.filter-chip select{border:none;background:transparent;font-family:'Cairo',sans-serif;font-size:.75rem;font-weight:600;color:inherit;outline:none;cursor:pointer;}
.filter-chip.active-filter select{color:white;}

/* â•â• SUMMARY PAGE â•â• */
.summary-page{padding:.5rem .85rem;}
.worker-summary-card{
  background:var(--surface);border:1px solid var(--border);border-radius:14px;
  padding:1rem;margin-bottom:.7rem;
  box-shadow:0 1px 8px rgba(44,26,14,.06);
}
.ws-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:.7rem;}
.ws-worker{display:flex;align-items:center;gap:.6rem;}
.ws-total{font-size:1.6rem;font-weight:900;color:var(--teal);}
.ws-total-lbl{font-size:.6rem;color:var(--ink3);text-align:center;line-height:1.2;}
.ws-models{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:.45rem;}
.ws-model-item{background:var(--bg2);border-radius:9px;padding:.4rem .5rem;text-align:center;}
.ws-model-name{font-size:.68rem;color:var(--ink2);font-weight:600;}
.ws-model-val{font-size:1rem;font-weight:800;color:var(--gold);}
.ws-bar{height:5px;background:var(--bg2);border-radius:10px;margin-top:.5rem;overflow:hidden;}
.ws-bar-fill{height:100%;border-radius:10px;background:linear-gradient(90deg,var(--teal),var(--teal2));transition:width .8s cubic-bezier(.34,1.56,.64,1);}

/* â•â• REPORT PAGE â•â• */
.report-page{padding:.5rem .85rem 0;}
.report-month-nav{
  display:flex;align-items:center;justify-content:space-between;
  background:var(--surface);border:1px solid var(--border);border-radius:14px;
  padding:.65rem 1rem;margin-bottom:.85rem;
  box-shadow:0 1px 8px rgba(44,26,14,.06);
}
.month-disp{font-family:'Amiri',serif;font-size:1.1rem;font-weight:700;color:var(--gold);}
.nav-arrow{width:36px;height:36px;border:1px solid var(--border2);background:var(--bg2);border-radius:9px;font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--ink2);}
.nav-arrow:active{background:var(--gold-light);}

.kpi-row{display:grid;grid-template-columns:1fr 1fr;gap:.65rem;margin-bottom:.85rem;}
.kpi-card{
  background:var(--surface);border:1px solid var(--border);border-radius:14px;
  padding:.85rem;text-align:center;position:relative;overflow:hidden;
  box-shadow:0 1px 8px rgba(44,26,14,.06);
}
.kpi-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.kpi-card.gold::before{background:linear-gradient(90deg,var(--gold),var(--gold2));}
.kpi-card.teal::before{background:linear-gradient(90deg,var(--teal),var(--teal2));}
.kpi-card.rose::before{background:linear-gradient(90deg,var(--rose),#c0392b);}
.kpi-card.blue::before{background:linear-gradient(90deg,var(--blue),#2980b9);}
.kpi-card.purple::before{background:linear-gradient(90deg,var(--purple),#7d3cff);}
.kpi-card.champion::before{background:linear-gradient(90deg,#f5c518,var(--gold));}
.kpi-card.champion{grid-column:1/-1;}
.kpi-icon2{font-size:1.3rem;margin-bottom:.2rem;}
.kpi-num{font-size:1.7rem;font-weight:900;}
.kpi-card.gold .kpi-num{color:var(--gold);}
.kpi-card.teal .kpi-num{color:var(--teal);}
.kpi-card.rose .kpi-num{color:var(--rose);}
.kpi-card.blue .kpi-num{color:var(--blue);}
.kpi-card.purple .kpi-num{color:var(--purple);}
.kpi-card.champion .kpi-num{color:var(--gold);font-size:1.2rem;}
.kpi-lbl{font-size:.65rem;color:var(--ink3);font-weight:600;margin-top:.15rem;}

.report-section{background:var(--surface);border:1px solid var(--border);border-radius:14px;margin-bottom:.85rem;overflow:hidden;box-shadow:0 1px 8px rgba(44,26,14,.06);}
.rs-header{padding:.65rem 1rem;background:var(--surface2);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:.4rem;}
.rs-title{font-family:'Amiri',serif;font-size:.92rem;font-weight:700;color:var(--ink);}
.rs-body{padding:.85rem;}

.bar-chart{display:flex;flex-direction:column;gap:.6rem;}
.bar-row{display:flex;align-items:center;gap:.65rem;}
.bar-lbl{font-size:.75rem;font-weight:600;color:var(--ink2);min-width:62px;text-align:right;}
.bar-track{flex:1;background:var(--bg2);border-radius:20px;height:22px;overflow:hidden;}
.bar-fill{height:100%;border-radius:20px;transition:width 1s cubic-bezier(.34,1.56,.64,1);display:flex;align-items:center;justify-content:flex-end;}
.bar-val{font-size:.7rem;font-weight:700;color:white;padding:0 .5rem;white-space:nowrap;}

.rank-list{display:flex;flex-direction:column;gap:.5rem;}
.rank-item{display:flex;align-items:center;gap:.7rem;background:var(--surface2);border:1px solid var(--border);border-radius:11px;padding:.6rem .8rem;}
.rank-num{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.72rem;font-weight:900;flex-shrink:0;}
.r1{background:linear-gradient(135deg,#f5c518,#e6a817);color:#3d2200;}
.r2{background:linear-gradient(135deg,#c0c0c0,#a0a0a0);color:#2c2c2c;}
.r3{background:linear-gradient(135deg,#cd7f32,#a56929);color:white;}
.rn{background:var(--bg2);color:var(--ink2);}
.rank-av{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold2));display:flex;align-items:center;justify-content:center;font-size:.78rem;font-weight:700;color:white;}
.rank-info{flex:1;}
.rank-name{font-weight:700;font-size:.86rem;}
.rank-sub{font-size:.65rem;color:var(--ink3);}
.rank-total{font-size:1.1rem;font-weight:900;color:var(--teal);}

.color-list{display:flex;flex-direction:column;gap:.45rem;}
.color-row{display:flex;align-items:center;gap:.6rem;}
.cswatch{width:16px;height:16px;border-radius:4px;border:1.5px solid rgba(0,0,0,.12);flex-shrink:0;}
.cname{font-size:.78rem;font-weight:600;color:var(--ink2);flex:1;}
.ctrack{flex:2;background:var(--bg2);border-radius:10px;height:9px;overflow:hidden;}
.cfill{height:100%;border-radius:10px;}
.ccnt{font-size:.72rem;font-weight:700;color:var(--ink);min-width:32px;text-align:left;}

.size-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:.4rem;margin-bottom:.7rem;}
.size-item{background:var(--bg2);border-radius:9px;padding:.5rem .3rem;text-align:center;}
.size-lbl{font-size:.72rem;font-weight:700;color:var(--teal);}
.size-val{font-size:1rem;font-weight:900;}
.size-pct{font-size:.6rem;color:var(--ink3);}

.daily-cards{display:flex;flex-direction:column;gap:.5rem;}
.day-card{background:var(--surface2);border:1px solid var(--border);border-radius:11px;padding:.65rem .85rem;display:flex;align-items:center;gap:.8rem;}
.day-date{min-width:75px;}
.day-d{font-size:.82rem;font-weight:700;color:var(--ink);}
.day-dow{font-size:.62rem;color:var(--ink3);}
.day-bar-wrap{flex:1;}
.day-bar-track{background:var(--bg2);border-radius:10px;height:10px;margin-top:.25rem;overflow:hidden;}
.day-bar-fill{height:100%;border-radius:10px;background:linear-gradient(90deg,var(--teal),var(--teal2));}
.day-qty{font-size:1.1rem;font-weight:900;color:var(--teal);}
.peak-chip{background:var(--gold-light);color:var(--gold);border-radius:5px;padding:.1rem .35rem;font-size:.6rem;font-weight:700;margin-right:.25rem;}

.export-btn-full{
  width:100%;padding:.85rem;
  background:linear-gradient(135deg,var(--blue),#2060b0);
  border:none;border-radius:13px;
  font-family:'Cairo',sans-serif;font-size:.9rem;font-weight:700;
  color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:.5rem;
  margin-bottom:.85rem;box-shadow:0 3px 12px rgba(26,74,139,.3);
  transition:transform .15s;
}
.export-btn-full:active{transform:scale(.97);}

/* â•â• SETTINGS PAGE â•â• */
.settings-page{padding:.5rem .85rem;}
.settings-section{background:var(--surface);border:1px solid var(--border);border-radius:14px;margin-bottom:.85rem;overflow:hidden;}
.settings-section-title{padding:.65rem 1rem;background:var(--surface2);border-bottom:1px solid var(--border);font-family:'Amiri',serif;font-size:.92rem;font-weight:700;color:var(--ink);}
.settings-item{
  display:flex;align-items:center;justify-content:space-between;
  padding:.75rem 1rem;border-bottom:1px solid var(--border);
}
.settings-item:last-child{border-bottom:none;}
.si-name{font-size:.88rem;font-weight:600;}
.si-sub{font-size:.68rem;color:var(--ink3);}
.si-actions{display:flex;gap:.4rem;}
.si-del{width:32px;height:32px;border:none;background:var(--rose-light);color:var(--rose);border-radius:8px;font-size:.85rem;cursor:pointer;display:flex;align-items:center;justify-content:center;}
.si-del:active{background:var(--rose);color:white;}
.add-item-row{padding:.7rem 1rem;}
.add-item-row input{width:100%;padding:.55rem .85rem;background:var(--bg2);border:1px solid var(--border2);border-radius:9px;font-family:'Cairo',sans-serif;font-size:.88rem;color:var(--ink);outline:none;}
.add-item-row input:focus{border-color:var(--gold);}
.add-item-btn{width:100%;margin-top:.4rem;padding:.55rem;background:var(--gold-light);border:1px solid rgba(184,137,42,.4);border-radius:9px;font-family:'Cairo',sans-serif;font-size:.82rem;font-weight:700;color:var(--gold);cursor:pointer;}
.add-item-btn:active{background:var(--gold);color:white;}

/* â•â• BOTTOM SHEET MODAL â•â• */
.overlay{position:fixed;inset:0;background:rgba(44,26,14,.55);backdrop-filter:blur(4px);display:none;align-items:flex-end;justify-content:center;z-index:200;padding:0;}
.overlay.show{display:flex;animation:overlayIn .2s ease;}
@keyframes overlayIn{from{opacity:0}to{opacity:1}}
.sheet{
  background:var(--surface);
  border-radius:20px 20px 0 0;
  width:100%;max-height:92vh;
  overflow-y:auto;-webkit-overflow-scrolling:touch;
  padding:0 0 calc(1rem + var(--safe-b));
  animation:sheetUp .28s cubic-bezier(.34,1.2,.64,1);
}
@keyframes sheetUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.sheet-handle{width:36px;height:4px;background:var(--border2);border-radius:2px;margin:.75rem auto .5rem;}
.sheet-title{font-family:'Amiri',serif;font-size:1.1rem;font-weight:700;color:var(--gold);padding:.3rem 1.2rem .8rem;border-bottom:1px solid var(--border);}
.sheet-body{padding:1rem 1.2rem;}

.form-group{margin-bottom:.9rem;}
.form-group label{display:block;font-size:.73rem;font-weight:700;color:var(--ink2);letter-spacing:.4px;text-transform:uppercase;margin-bottom:.3rem;}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:.65rem .9rem;background:var(--bg2);border:1.5px solid var(--border2);border-radius:11px;font-family:'Cairo',sans-serif;font-size:1rem;color:var(--ink);outline:none;transition:border-color .2s;-webkit-appearance:none;}
.form-group input:focus,.form-group select:focus{border-color:var(--gold);background:white;}
.form-grid2{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;}

.color-picker{display:flex;flex-wrap:wrap;gap:.45rem;margin-top:.3rem;}
.cpick{display:flex;flex-direction:column;align-items:center;gap:.2rem;padding:.35rem .4rem;border-radius:9px;cursor:pointer;border:2px solid transparent;transition:all .15s;min-width:50px;font-size:.62rem;font-weight:600;color:var(--ink2);}
.cpick.active{border-color:var(--gold);background:var(--gold-light);}
.cpick .cdot{width:22px;height:22px;border-radius:50%;border:2px solid rgba(0,0,0,.15);}
.cpick:active{transform:scale(.9);}

.qty-control{display:flex;align-items:center;gap:.75rem;}
.qty-btn{width:44px;height:44px;border:none;background:var(--gold-light);border-radius:11px;font-size:1.3rem;font-weight:700;color:var(--gold);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;}
.qty-btn:active{background:var(--gold);color:white;transform:scale(.92);}
.qty-val{flex:1;text-align:center;font-size:1.5rem;font-weight:900;color:var(--ink);}

.sheet-btns{display:flex;gap:.65rem;margin-top:1rem;}
.sbtn{flex:1;padding:.75rem;border:none;border-radius:12px;font-family:'Cairo',sans-serif;font-size:.88rem;font-weight:700;cursor:pointer;transition:all .15s;}
.sbtn:active{transform:scale(.96);}
.sbtn-gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:white;}
.sbtn-ghost{background:var(--bg2);color:var(--ink2);border:1px solid var(--border2);}
.sbtn-danger{background:var(--rose);color:white;}

/* Confirm sheet */
.confirm-icon{font-size:2.5rem;text-align:center;margin:.5rem 0;}
.confirm-msg{text-align:center;color:var(--ink2);font-size:.9rem;line-height:1.6;margin-bottom:1rem;}

/* â•â• TOAST â•â• */
.toast{
  position:fixed;bottom:calc(var(--nav-h) + var(--safe-b) + .8rem);
  left:50%;transform:translateX(-50%) translateY(20px);
  background:var(--ink);color:white;
  border-radius:25px;padding:.65rem 1.4rem;
  font-size:.83rem;font-weight:600;
  transition:all .3s ease;z-index:300;
  box-shadow:0 6px 20px rgba(0,0,0,.3);
  opacity:0;pointer-events:none;white-space:nowrap;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.toast.success{background:var(--teal);}
.toast.error{background:var(--rose);}
.toast.info{background:var(--gold);}
</style>
</head>
<body>

<!-- Top Bar -->
<div class="topbar">
  <div class="topbar-brand">
    <div class="topbar-icon">ğŸ§µ</div>
    <div>
      <div class="topbar-title">ÙˆØ±Ø´Ø© Ø§Ù„Ø®ÙŠØ§Ø·Ø©</div>
      <div class="topbar-sub">Ø³Ø¬Ù„ Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø¬Ø¨Ø¨</div>
    </div>
  </div>
  <div style="display:flex;gap:.4rem">
    <button class="topbar-btn" onclick="exportXLSX()" title="ØªØµØ¯ÙŠØ± Excel">ğŸ“Š</button>
  </div>
</div>

<!-- Scroll Area -->
<div class="scroll-area" id="scrollArea">

  <!-- â•â• PAGE: Records â•â• -->
  <div class="page active" id="page-records">
    <div id="miniStats"></div>
    <div class="filter-scroll" id="filterBar"></div>
    <div class="sec-header">
      <div class="sec-title">ğŸª¡ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬</div>
      <span class="sec-count" id="recCount">0</span>
    </div>
    <div class="cards-list" id="cardsList"></div>
    <div class="empty" id="emptyState" style="display:none">
      <div class="empty-icon">ğŸ§µ</div>
      <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª<br>Ø§Ø¶ØºØ· + Ù„Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø³Ø¬Ù„</p>
    </div>
  </div>

  <!-- â•â• PAGE: Summary â•â• -->
  <div class="page" id="page-summary">
    <div class="sec-header" style="padding-top:.85rem">
      <div class="sec-title">ğŸ“‹ Ù…Ù„Ø®Øµ ÙƒÙ„ Ù…ÙˆØ¸ÙØ©</div>
    </div>
    <div class="summary-page" id="summaryPage"></div>
  </div>

  <!-- â•â• PAGE: Report â•â• -->
  <div class="page" id="page-report">
    <div class="report-page" id="reportPage"></div>
  </div>

  <!-- â•â• PAGE: Settings â•â• -->
  <div class="page" id="page-settings">
    <div class="sec-header" style="padding-top:.85rem">
      <div class="sec-title">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
    </div>
    <div class="settings-page" id="settingsPage"></div>
  </div>

</div>

<!-- FAB (only on records page) -->
<button class="fab" id="fab" onclick="openAddRecord()">+</button>

<!-- Bottom Nav -->
<nav class="bottom-nav">
  <button class="nav-btn active" id="nav-records" onclick="showPage('records')">
    <span class="nav-icon">ğŸª¡</span>Ø§Ù„Ø³Ø¬Ù„Ø§Øª
  </button>
  <button class="nav-btn" id="nav-summary" onclick="showPage('summary')">
    <span class="nav-icon">ğŸ“‹</span>Ø§Ù„Ù…Ù„Ø®Øµ
  </button>
  <button class="nav-btn" id="nav-report" onclick="showPage('report')">
    <span class="nav-icon">ğŸ“…</span>Ø§Ù„ØªÙ‚Ø±ÙŠØ±
  </button>
  <button class="nav-btn" id="nav-settings" onclick="showPage('settings')">
    <span class="nav-icon">âš™ï¸</span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  </button>
</nav>

<!-- Sheet: Add/Edit Record -->
<div class="overlay" id="recordOverlay">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-title" id="recordSheetTitle">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¥Ù†ØªØ§Ø¬</div>
    <div class="sheet-body">
      <div class="form-grid2">
        <div class="form-group"><label>Ø§Ù„Ù…ÙˆØ¸ÙØ© *</label><select id="r_worker"></select></div>
        <div class="form-group"><label>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ *</label><select id="r_model"></select></div>
      </div>
      <div class="form-grid2">
        <div class="form-group"><label>Ø§Ù„Ù…Ù‚Ø§Ø³ *</label>
          <select id="r_size"><option>M</option><option>L</option><option selected>XL</option><option>XXL</option><option>3XL</option></select>
        </div>
        <div class="form-group"><label>Ø§Ù„ØªØ§Ø±ÙŠØ® *</label><input type="date" id="r_date"></div>
      </div>
      <div class="form-group">
        <label>Ø§Ù„Ø¹Ø¯Ø¯ *</label>
        <div class="qty-control">
          <button class="qty-btn" onclick="changeQty(-1)">âˆ’</button>
          <div class="qty-val" id="qtyDisplay">1</div>
          <button class="qty-btn" onclick="changeQty(1)">+</button>
        </div>
        <input type="hidden" id="r_qty" value="1">
      </div>
      <div class="form-group">
        <label>Ø§Ù„Ù„ÙˆÙ† *</label>
        <div class="color-picker" id="colorPicker"></div>
        <input type="hidden" id="r_color">
      </div>
      <div class="form-group"><label>Ù…Ù„Ø§Ø­Ø¸Ø©</label><input type="text" id="r_note" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ..."></div>
      <div class="sheet-btns">
        <button class="sbtn sbtn-ghost" onclick="closeSheet('recordOverlay')">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="sbtn sbtn-gold" onclick="saveRecord()">ğŸ’¾ Ø­ÙØ¸</button>
      </div>
    </div>
  </div>
</div>

<!-- Sheet: Delete Confirm -->
<div class="overlay" id="deleteOverlay">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-title" style="color:var(--rose)">ğŸ—‘ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</div>
    <div class="sheet-body">
      <div class="confirm-icon">âš ï¸</div>
      <p class="confirm-msg">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ<br><strong>Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.</strong></p>
      <div class="sheet-btns">
        <button class="sbtn sbtn-ghost" onclick="closeSheet('deleteOverlay')">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="sbtn sbtn-danger" onclick="confirmDelete()">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let workers=['Ù†Ø§Ø±ÙŠÙ…Ø§Ù†','Ù…ÙŠÙ†Ø§','Ø´Ø§Ù‡ÙŠÙ†Ø§Ø²','Ø³ÙˆÙŠÙƒÙŠ'];
let models=['ÙƒÙ†ÙØ©','Ù…Ø¹ÙŠÙ†Ø§Øª','Ù…Ø±Ø¨Ø¹Ø§Øª','ØºØ§Ù„ÙˆÙ†','ÙƒÙˆÙ„ÙÙŠ'];
let colors=[
  {name:'Ø§Ø­Ù…Ø±',hex:'#c0392b'},{name:'Ù…ÙˆÙ',hex:'#9b59b6'},{name:'Ù…ÙŠÙ„ÙƒØ§',hex:'#d7bde2'},
  {name:'Ø²ÙŠØªÙŠ',hex:'#6b8e23'},{name:'Ø¨Ù„ÙˆÙ†ÙˆÙŠ',hex:'#5dade2'},{name:'ØºØ±ÙˆÙ†Ø§',hex:'#8e1515'},
  {name:'Ø¨ÙŠØ³ØªØ§Ø´',hex:'#a8d8a8'},{name:'ÙÙŠØ±Ø¯Ùˆ',hex:'#27ae60'},{name:'ØªØ±ÙƒÙˆØ§Ø²',hex:'#1abc9c'},
  {name:'Ø¨ÙŠØ¬',hex:'#d4b896'},{name:'Ø²Ù‡Ø±',hex:'#f1948a'},{name:'Ø§Ø²Ø±Ù‚',hex:'#2980b9'},
];
const AM=['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
const AD=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
const MC=['#b8892a','#1a6b5c','#8b2a3a','#1a4a8b','#5a2a8b','#2c7a5c','#7a5c2c','#5c2c7a'];

let records=[],nextId=1,editingId=null,deletingId=null,selColor='',filtW='',filtM='',filtC='',filtS='';
let rYear=new Date().getFullYear(),rMonth=new Date().getMonth();
const today=new Date().toISOString().split('T')[0];
let curQty=1;

// Seed
(function(){
  const now=new Date();
  const push=(y,m,day,w,mod,sz,col,qty)=>{
    const d=new Date(y,m,day);if(d.getDay()===5)return;
    records.push({id:nextId++,worker:w,model:mod,size:sz,color:col,qty,note:'',
      date:`${y}-${String(m+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`});
  };
  for(let i=0;i<28;i++) push(now.getFullYear(),now.getMonth(),Math.min(i+1,27),workers[i%4],models[i%5],['M','L','XL','XXL','3XL'][i%5],colors[i%12].name,Math.floor(Math.random()*9)+2);
  for(let i=0;i<20;i++){const lm=now.getMonth()-1<0?11:now.getMonth()-1,ly=now.getMonth()-1<0?now.getFullYear()-1:now.getFullYear();push(ly,lm,Math.min(i+1,27),workers[(i+1)%4],models[(i+2)%5],['XL','XXL','L','M','3XL'][i%5],colors[(i+4)%12].name,Math.floor(Math.random()*8)+1);}
  for(let i=0;i<12;i++){let lm=now.getMonth()-2,ly=now.getFullYear();if(lm<0){lm+=12;ly--;}push(ly,lm,Math.min(i+1,25),workers[(i+2)%4],models[(i+1)%5],['L','XL','XXL','M','3XL'][i%5],colors[(i+7)%12].name,Math.floor(Math.random()*7)+1);}
})();

// â”€â”€ NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(n){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('page-'+n).classList.add('active');
  document.getElementById('nav-'+n).classList.add('active');
  document.getElementById('fab').style.display=n==='records'?'flex':'none';
  document.getElementById('scrollArea').scrollTop=0;
  if(n==='summary')renderSummary();
  if(n==='report')renderReport();
  if(n==='settings')renderSettings();
}

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function gch(n){return(colors.find(c=>c.name===n)||{}).hex||'#aaa';}
function gmr(y,m){const p=`${y}-${String(m+1).padStart(2,'0')}`;return records.filter(r=>r.date.startsWith(p));}
function closeSheet(id){document.getElementById(id).classList.remove('show');}
function changeQty(d){curQty=Math.max(1,curQty+d);document.getElementById('qtyDisplay').textContent=curQty;document.getElementById('r_qty').value=curQty;}

// â”€â”€ RECORDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function applyFilters(){
  let fr=records;
  if(filtW) fr=fr.filter(r=>r.worker===filtW);
  if(filtM) fr=fr.filter(r=>r.model===filtM);
  if(filtC) fr=fr.filter(r=>r.color===filtC);
  if(filtS) fr=fr.filter(r=>r.size===filtS);
  renderCards(fr);
  renderMiniStats(fr);
}

function renderMiniStats(fr){
  const total=fr.reduce((s,r)=>s+r.qty,0);
  const wm={};fr.forEach(r=>wm[r.worker]=(wm[r.worker]||0)+r.qty);
  const best=Object.entries(wm).sort((a,b)=>b[1]-a[1])[0];
  document.getElementById('miniStats').innerHTML=`<div class="mini-stats">
    <div class="mini-stat"><div class="mini-stat-icon">ğŸ§µ</div><div><div class="mini-stat-val">${total}</div><div class="mini-stat-lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¬Ø¨Ø¨</div></div></div>
    <div class="mini-stat"><div class="mini-stat-icon">ğŸ“‹</div><div><div class="mini-stat-val">${fr.length}</div><div class="mini-stat-lbl">Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div></div></div>
    <div class="mini-stat"><div class="mini-stat-icon">ğŸ‘©</div><div><div class="mini-stat-val">${new Set(fr.map(r=>r.worker)).size}</div><div class="mini-stat-lbl">Ù…ÙˆØ¸ÙØ§Øª</div></div></div>
    ${best?`<div class="mini-stat" style="border-color:var(--gold2)"><div class="mini-stat-icon">ğŸ†</div><div><div class="mini-stat-val" style="color:var(--gold);font-size:.88rem">${best[0]}</div><div class="mini-stat-lbl">${best[1]} Ø¬Ø¨Ø©</div></div></div>`:''}
  </div>`;
}

function renderFilterBar(){
  document.getElementById('filterBar').innerHTML=`
    <div class="filter-chip${filtW?' active-filter':''}">
      ğŸ‘© <select onchange="filtW=this.value;applyFilters()" style="max-width:70px">
        <option value="">Ø§Ù„ÙƒÙ„</option>${workers.map(w=>`<option${w===filtW?' selected':''}>${w}</option>`).join('')}
      </select>
    </div>
    <div class="filter-chip${filtM?' active-filter':''}">
      ğŸ‘— <select onchange="filtM=this.value;applyFilters()" style="max-width:65px">
        <option value="">Ø§Ù„ÙƒÙ„</option>${models.map(m=>`<option${m===filtM?' selected':''}>${m}</option>`).join('')}
      </select>
    </div>
    <div class="filter-chip${filtS?' active-filter':''}">
      ğŸ“ <select onchange="filtS=this.value;applyFilters()" style="max-width:55px">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        ${['M','L','XL','XXL','3XL'].map(s=>`<option${s===filtS?' selected':''}>${s}</option>`).join('')}
      </select>
    </div>
    <div class="filter-chip${filtC?' active-filter':''}">
      ğŸ¨ <select onchange="filtC=this.value;applyFilters()" style="max-width:65px">
        <option value="">Ø§Ù„ÙƒÙ„</option>${colors.map(c=>`<option value="${c.name}"${c.name===filtC?' selected':''}>${c.name}</option>`).join('')}
      </select>
    </div>
    <div class="filter-chip" onclick="filtW='';filtM='';filtS='';filtC='';applyFilters();renderFilterBar()">âœ• Ù…Ø³Ø­</div>`;
}

function renderCards(fr){
  const el=document.getElementById('cardsList'),em=document.getElementById('emptyState');
  document.getElementById('recCount').textContent=fr.length;
  if(!fr.length){el.innerHTML='';em.style.display='block';return;}
  em.style.display='none';
  el.innerHTML=[...fr].reverse().map(r=>{
    const hex=gch(r.color);
    return `<div class="rec-card">
      <div class="rec-card-top">
        <div class="rec-worker">
          <div class="worker-avatar">${r.worker.charAt(0)}</div>
          <div><div class="worker-name">${r.worker}</div><div class="worker-date">${r.date}</div></div>
        </div>
        <div style="text-align:center"><div class="rec-qty">${r.qty}</div><div class="rec-qty-lbl">Ø¬Ø¨Ø©</div></div>
      </div>
      <div class="rec-card-tags">
        <span class="tag tag-model">ğŸ‘— ${r.model}</span>
        <span class="tag tag-size">ğŸ“ ${r.size}</span>
        <span class="tag tag-color" style="background:${hex}22;color:${hex};border-color:${hex}44">
          <span class="cdot-sm" style="background:${hex}"></span>${r.color}</span>
      </div>
      ${r.note?`<div class="rec-note">ğŸ“ ${r.note}</div>`:''}
      <div class="rec-actions">
        <button class="act-btn act-edit" onclick="openEditRecord(${r.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="act-btn act-del" onclick="openDelete(${r.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </div>
    </div>`;}).join('');
}

// â”€â”€ RECORD CRUD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildColorPicker(){
  document.getElementById('colorPicker').innerHTML=colors.map(c=>`
    <div class="cpick${selColor===c.name?' active':''}" onclick="pickColor('${c.name}')" id="cp_${c.name}">
      <div class="cdot" style="background:${c.hex}"></div><span>${c.name}</span></div>`).join('');
}
function pickColor(n){
  selColor=n;document.getElementById('r_color').value=n;
  document.querySelectorAll('.cpick').forEach(el=>el.classList.remove('active'));
  const el=document.getElementById('cp_'+n);if(el)el.classList.add('active');
}
function populateForm(){
  document.getElementById('r_worker').innerHTML=workers.map(w=>`<option>${w}</option>`).join('');
  document.getElementById('r_model').innerHTML=models.map(m=>`<option>${m}</option>`).join('');
}
function openAddRecord(){
  editingId=null;selColor='';curQty=1;
  document.getElementById('recordSheetTitle').textContent='â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¥Ù†ØªØ§Ø¬';
  document.getElementById('r_date').value=today;
  document.getElementById('qtyDisplay').textContent='1';
  document.getElementById('r_qty').value='1';
  document.getElementById('r_note').value='';
  populateForm();buildColorPicker();
  document.getElementById('recordOverlay').classList.add('show');
}
function openEditRecord(id){
  const rec=records.find(r=>r.id===id);if(!rec)return;
  editingId=id;selColor=rec.color;curQty=rec.qty;
  document.getElementById('recordSheetTitle').textContent='âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„';
  populateForm();
  document.getElementById('r_worker').value=rec.worker;
  document.getElementById('r_model').value=rec.model;
  document.getElementById('r_size').value=rec.size;
  document.getElementById('r_date').value=rec.date;
  document.getElementById('qtyDisplay').textContent=rec.qty;
  document.getElementById('r_qty').value=rec.qty;
  document.getElementById('r_note').value=rec.note||'';
  buildColorPicker();
  document.getElementById('recordOverlay').classList.add('show');
}
function saveRecord(){
  const w=document.getElementById('r_worker').value,m=document.getElementById('r_model').value,
    s=document.getElementById('r_size').value,q=parseInt(document.getElementById('r_qty').value)||0,
    d=document.getElementById('r_date').value,n=document.getElementById('r_note').value.trim(),
    c=document.getElementById('r_color').value||selColor;
  if(!w||!m||!s||q<1||!d||!c){showToast('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ø®ØªÙŠØ§Ø± Ù„ÙˆÙ†','error');return;}
  if(editingId){const i=records.findIndex(r=>r.id===editingId);if(i>-1)records[i]={id:editingId,worker:w,model:m,size:s,color:c,qty:q,date:d,note:n};showToast('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ âœ“','success');}
  else{records.push({id:nextId++,worker:w,model:m,size:s,color:c,qty:q,date:d,note:n});showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„ âœ“','success');}
  closeSheet('recordOverlay');renderFilterBar();applyFilters();
}
function openDelete(id){deletingId=id;document.getElementById('deleteOverlay').classList.add('show');}
function confirmDelete(){records=records.filter(r=>r.id!==deletingId);closeSheet('deleteOverlay');applyFilters();showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„','info');}

// â”€â”€ SUMMARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSummary(){
  const am=[...new Set([...models,...records.map(r=>r.model)])];
  const wt={};workers.forEach(w=>{wt[w]={total:0};am.forEach(m=>wt[w][m]=0);});
  records.forEach(r=>{if(!wt[r.worker])wt[r.worker]={total:0};if(wt[r.worker][r.model]===undefined)wt[r.worker][r.model]=0;wt[r.worker][r.model]+=r.qty;wt[r.worker].total+=r.qty;});
  const maxT=Math.max(...workers.map(w=>wt[w]?.total||0),1);
  document.getElementById('summaryPage').innerHTML=workers.map(w=>{
    const d=wt[w]||{};const pct=Math.round((d.total||0)/maxT*100);
    return `<div class="worker-summary-card">
      <div class="ws-header">
        <div class="ws-worker">
          <div class="worker-avatar" style="width:38px;height:38px;font-size:.95rem">${w.charAt(0)}</div>
          <div><div style="font-weight:700;font-size:.95rem">${w}</div><div style="font-size:.68rem;color:var(--ink3)">${records.filter(r=>r.worker===w).length} Ø³Ø¬Ù„</div></div>
        </div>
        <div style="text-align:center"><div class="ws-total">${d.total||0}</div><div class="ws-total-lbl">Ø¬Ø¨Ø©</div></div>
      </div>
      <div class="ws-bar"><div class="ws-bar-fill" style="width:${pct}%"></div></div>
      <div class="ws-models" style="margin-top:.7rem">
        ${am.filter(m=>d[m]>0).map(m=>`<div class="ws-model-item"><div class="ws-model-name">${m}</div><div class="ws-model-val">${d[m]||0}</div></div>`).join('')}
      </div>
    </div>`;}).join('');
}

// â”€â”€ REPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderReport(){
  const mr=gmr(rYear,rMonth),mn=AM[rMonth]+' '+rYear;
  const totalQ=mr.reduce((s,r)=>s+r.qty,0);
  const days=new Set(mr.map(r=>r.date));
  const avg=days.size?(totalQ/days.size).toFixed(1):0;
  const wm={};mr.forEach(r=>wm[r.worker]=(wm[r.worker]||0)+r.qty);
  const best=Object.entries(wm).sort((a,b)=>b[1]-a[1])[0];

  let html=`
    <div class="report-month-nav">
      <button class="nav-arrow" onclick="rMonth--;if(rMonth<0){rMonth=11;rYear--;}renderReport()">â—€</button>
      <div class="month-disp">${mn}</div>
      <button class="nav-arrow" onclick="rMonth++;if(rMonth>11){rMonth=0;rYear++;}renderReport()">â–¶</button>
    </div>
    <div class="kpi-row">
      <div class="kpi-card gold"><div class="kpi-icon2">ğŸ§µ</div><div class="kpi-num">${totalQ}</div><div class="kpi-lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¬Ø¨Ø¨</div></div>
      <div class="kpi-card teal"><div class="kpi-icon2">ğŸ“‹</div><div class="kpi-num">${mr.length}</div><div class="kpi-lbl">Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div></div>
      <div class="kpi-card blue"><div class="kpi-icon2">ğŸ‘©</div><div class="kpi-num">${new Set(mr.map(r=>r.worker)).size}</div><div class="kpi-lbl">Ù…ÙˆØ¸ÙØ§Øª Ù†Ø´Ø·Ø§Øª</div></div>
      <div class="kpi-card rose"><div class="kpi-icon2">ğŸ“ˆ</div><div class="kpi-num">${avg}</div><div class="kpi-lbl">Ù…ØªÙˆØ³Ø· ÙŠÙˆÙ…ÙŠ</div></div>
      <div class="kpi-card purple"><div class="kpi-icon2">ğŸ‘—</div><div class="kpi-num">${new Set(mr.map(r=>r.model)).size}</div><div class="kpi-lbl">Ù…ÙˆØ¯ÙŠÙ„Ø§Øª</div></div>
      <div class="kpi-card gold"><div class="kpi-icon2">ğŸ“…</div><div class="kpi-num">${days.size}</div><div class="kpi-lbl">Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ù†ØªØ§Ø¬</div></div>
      ${best?`<div class="kpi-card champion"><div class="kpi-icon2">ğŸ†</div><div class="kpi-num">${best[0]} â€” ${best[1]} Ø¬Ø¨Ø©</div><div class="kpi-lbl">Ø§Ù„Ù…ÙˆØ¸ÙØ© Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¥Ù†ØªØ§Ø¬Ø§Ù‹</div></div>`:''}
    </div>`;

  // Ranking
  const sorted=Object.entries(wm).sort((a,b)=>b[1]-a[1]);
  const maxW=sorted[0]?.[1]||1;
  if(sorted.length){
    html+=`<div class="report-section"><div class="rs-header"><span class="rs-title">ğŸ† ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙØ§Øª</span></div><div class="rs-body"><div class="rank-list">`;
    sorted.forEach(([w,q],i)=>{
      const rc=i===0?'r1':i===1?'r2':i===2?'r3':'rn';
      const wr=mr.filter(r=>r.worker===w);
      html+=`<div class="rank-item">
        <div class="rank-num ${rc}">${i+1}</div>
        <div class="rank-av">${w.charAt(0)}</div>
        <div class="rank-info"><div class="rank-name">${w}</div><div class="rank-sub">${new Set(wr.map(r=>r.date)).size} ÙŠÙˆÙ… â€¢ ${wr.length} Ø³Ø¬Ù„</div></div>
        <div class="rank-total">${q}</div>
      </div>`;
    });
    html+=`</div></div></div>`;
  }

  // Worker bars
  if(sorted.length){
    html+=`<div class="report-section"><div class="rs-header"><span class="rs-title">ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬</span></div><div class="rs-body"><div class="bar-chart">`;
    sorted.forEach(([w,q],i)=>{const pct=Math.round(q/maxW*100);html+=`<div class="bar-row"><div class="bar-lbl">${w}</div><div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${MC[i%MC.length]}"><span class="bar-val">${q}</span></div></div></div>`;});
    html+=`</div></div></div>`;
  }

  // Model breakdown
  const mm={};mr.forEach(r=>mm[r.model]=(mm[r.model]||0)+r.qty);
  const sortedM=Object.entries(mm).sort((a,b)=>b[1]-a[1]);
  if(sortedM.length){
    const maxMM=sortedM[0][1];
    html+=`<div class="report-section"><div class="rs-header"><span class="rs-title">ğŸ‘— Ø¥Ù†ØªØ§Ø¬ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</span></div><div class="rs-body"><div class="bar-chart">`;
    sortedM.forEach(([m,q],i)=>{const pct=Math.round(q/maxMM*100);html+=`<div class="bar-row"><div class="bar-lbl">${m}</div><div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${MC[(i+2)%MC.length]}"><span class="bar-val">${q}</span></div></div></div>`;});
    html+=`</div></div></div>`;
  }

  // Colors
  const cm2={};mr.forEach(r=>cm2[r.color]=(cm2[r.color]||0)+r.qty);
  const sortedC=Object.entries(cm2).sort((a,b)=>b[1]-a[1]).slice(0,10);
  const totalQC=sortedC.reduce((s,[,q])=>s+q,0)||1;
  if(sortedC.length){
    html+=`<div class="report-section"><div class="rs-header"><span class="rs-title">ğŸ¨ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</span></div><div class="rs-body"><div class="color-list">`;
    sortedC.forEach(([n,q])=>{const hex=gch(n);const pct=Math.round(q/totalQC*100);html+=`<div class="color-row"><div class="cswatch" style="background:${hex}"></div><div class="cname">${n}</div><div class="ctrack"><div class="cfill" style="width:${pct}%;background:${hex}"></div></div><div class="ccnt">${q}</div></div>`;});
    html+=`</div></div></div>`;
  }

  // Sizes
  const szs=['M','L','XL','XXL','3XL'],szc=['#b8892a','#1a6b5c','#8b2a3a','#1a4a8b','#5a2a8b'];
  const szm={};szs.forEach(s=>szm[s]=0);mr.forEach(r=>szm[r.size]=(szm[r.size]||0)+r.qty);
  const totalSz=Object.values(szm).reduce((a,b)=>a+b,0)||1;
  html+=`<div class="report-section"><div class="rs-header"><span class="rs-title">ğŸ“ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª</span></div><div class="rs-body">
    <div class="size-grid">${szs.map((s,i)=>`<div class="size-item"><div class="size-lbl">${s}</div><div class="size-val">${szm[s]}</div><div class="size-pct">${Math.round(szm[s]/totalSz*100)}%</div></div>`).join('')}</div>
    <div class="bar-chart">${szs.map((s,i)=>{const pct=Math.round(szm[s]/totalSz*100);return`<div class="bar-row"><div class="bar-lbl" style="min-width:38px">${s}</div><div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${szc[i]}"><span class="bar-val">${szm[s]}</span></div></div></div>`;}).join('')}</div>
  </div></div>`;

  // Daily
  const dm={};mr.forEach(r=>{if(!dm[r.date])dm[r.date]={q:0,w:new Set()};dm[r.date].q+=r.qty;dm[r.date].w.add(r.worker);});
  const sortedD=Object.keys(dm).sort();
  const maxDQ=Math.max(...sortedD.map(d=>dm[d].q),0);
  if(sortedD.length){
    html+=`<div class="report-section"><div class="rs-header"><span class="rs-title">ğŸ“† Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ÙŠÙˆÙ…ÙŠ</span></div><div class="rs-body"><div class="daily-cards">`;
    sortedD.forEach(d=>{
      const data=dm[d],dow=new Date(d).getDay(),isPeak=data.q===maxDQ;
      const pct=Math.round(data.q/maxDQ*100);
      html+=`<div class="day-card">
        <div class="day-date"><div class="day-d">${d.slice(8)}<span style="font-size:.68rem;color:var(--ink3)"> / ${d.slice(5,7)}</span></div><div class="day-dow">${AD[dow]}</div></div>
        <div class="day-bar-wrap"><div style="display:flex;align-items:center;gap:.3rem">${isPeak?'<span class="peak-chip">ğŸ”¥ Ø°Ø±ÙˆØ©</span>':''}<span style="font-size:.72rem;color:var(--ink3)">${data.w.size} Ù…ÙˆØ¸ÙØ©</span></div><div class="day-bar-track"><div class="day-bar-fill" style="width:${pct}%"></div></div></div>
        <div class="day-qty">${data.q}</div>
      </div>`;
    });
    html+=`</div></div></div>`;
  }

  html+=`<button class="export-btn-full" onclick="exportMonthlyReport()">ğŸ“Š ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± ${mn}</button>`;
  document.getElementById('reportPage').innerHTML=html;
}

// â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSettings(){
  document.getElementById('settingsPage').innerHTML=`
    <!-- Workers -->
    <div class="settings-section">
      <div class="settings-section-title">ğŸ‘© Ø§Ù„Ù…ÙˆØ¸ÙØ§Øª</div>
      ${workers.map((w,i)=>`<div class="settings-item">
        <div><div class="si-name">${w}</div><div class="si-sub">Ù…ÙˆØ¸ÙØ© #${i+1}</div></div>
        <div class="si-actions"><button class="si-del" onclick="removeWorker('${w}')">ğŸ—‘ï¸</button></div>
      </div>`).join('')}
      <div class="add-item-row">
        <input type="text" id="new_worker" placeholder="Ø§Ø³Ù… Ù…ÙˆØ¸ÙØ© Ø¬Ø¯ÙŠØ¯Ø©...">
        <button class="add-item-btn" onclick="addWorker()">+ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸ÙØ©</button>
      </div>
    </div>
    <!-- Models -->
    <div class="settings-section">
      <div class="settings-section-title">ğŸ‘— Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª</div>
      ${models.map((m,i)=>`<div class="settings-item">
        <div><div class="si-name">${m}</div><div class="si-sub">Ù…ÙˆØ¯ÙŠÙ„ #${i+1}</div></div>
        <div class="si-actions"><button class="si-del" onclick="removeModel('${m}')">ğŸ—‘ï¸</button></div>
      </div>`).join('')}
      <div class="add-item-row">
        <input type="text" id="new_model" placeholder="Ø§Ø³Ù… Ù…ÙˆØ¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯...">
        <button class="add-item-btn" onclick="addModel()">+ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„</button>
      </div>
    </div>
    <!-- Colors -->
    <div class="settings-section">
      <div class="settings-section-title">ğŸ¨ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</div>
      ${colors.map(c=>`<div class="settings-item">
        <div style="display:flex;align-items:center;gap:.6rem">
          <div style="width:20px;height:20px;border-radius:5px;background:${c.hex};border:2px solid rgba(0,0,0,.1)"></div>
          <div class="si-name">${c.name}</div>
        </div>
        <div class="si-actions"><button class="si-del" onclick="removeColor('${c.name}')">ğŸ—‘ï¸</button></div>
      </div>`).join('')}
      <div class="add-item-row">
        <input type="text" id="new_color_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„ÙˆÙ†...">
        <div style="display:flex;gap:.5rem;margin-top:.4rem">
          <input type="color" id="new_color_hex" value="#6699cc" style="width:48px;height:40px;border-radius:9px;border:1px solid var(--border2);cursor:pointer;padding:2px;">
          <button class="add-item-btn" style="flex:1;margin:0" onclick="addColor()">+ Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ†</button>
        </div>
      </div>
    </div>
    <!-- Export -->
    <div class="settings-section">
      <div class="settings-section-title">ğŸ“Š Ø§Ù„ØªØµØ¯ÙŠØ±</div>
      <div style="padding:.85rem 1rem">
        <button class="export-btn-full" style="margin:0" onclick="exportXLSX()">ğŸ“Š ØªØµØ¯ÙŠØ± ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
      </div>
    </div>`;
}

function addWorker(){const n=document.getElementById('new_worker').value.trim();if(!n){showToast('Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„Ø§Ø³Ù…','error');return;}if(workers.includes(n)){showToast('Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹','error');return;}workers.push(n);document.getElementById('new_worker').value='';renderSettings();showToast(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${n} âœ“`,'success');}
function removeWorker(n){workers=workers.filter(w=>w!==n);renderSettings();showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù','info');}
function addModel(){const n=document.getElementById('new_model').value.trim();if(!n){showToast('Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„','error');return;}if(models.includes(n)){showToast('Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹','error');return;}models.push(n);document.getElementById('new_model').value='';renderSettings();showToast(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„ ${n} âœ“`,'success');}
function removeModel(n){models=models.filter(m=>m!==n);renderSettings();showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù','info');}
function addColor(){const n=document.getElementById('new_color_name').value.trim(),h=document.getElementById('new_color_hex').value;if(!n){showToast('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù„ÙˆÙ†','error');return;}if(colors.find(c=>c.name===n)){showToast('Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹','error');return;}colors.push({name:n,hex:h});document.getElementById('new_color_name').value='';renderSettings();showToast(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙˆÙ† ${n} âœ“`,'success');}
function removeColor(n){colors=colors.filter(c=>c.name!==n);renderSettings();showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù','info');}

// â”€â”€ EXPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportXLSX(){
  const wb=XLSX.utils.book_new(),am=[...new Set([...models,...records.map(r=>r.model)])];
  const r1=[['#','Ø§Ù„Ù…ÙˆØ¸ÙØ©','Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„','Ø§Ù„Ù…Ù‚Ø§Ø³','Ø§Ù„Ù„ÙˆÙ†','Ø§Ù„Ø¹Ø¯Ø¯','Ø§Ù„ØªØ§Ø±ÙŠØ®','Ù…Ù„Ø§Ø­Ø¸Ø©'],...records.map((r,i)=>[i+1,r.worker,r.model,r.size,r.color,r.qty,r.date,r.note||''])];
  const ws1=XLSX.utils.aoa_to_sheet(r1);ws1['!cols']=[{wch:5},{wch:12},{wch:12},{wch:8},{wch:10},{wch:8},{wch:12},{wch:20}];XLSX.utils.book_append_sheet(wb,ws1,'Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©');
  const h2=['Ø§Ù„Ù…ÙˆØ¸ÙØ©',...am,'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'],r2=[h2],gt={total:0};am.forEach(m=>gt[m]=0);
  workers.forEach(w=>{const d={total:0};am.forEach(m=>d[m]=0);records.filter(r=>r.worker===w).forEach(r=>{d[r.model]+=r.qty;d.total+=r.qty;});am.forEach(m=>gt[m]+=d[m]);gt.total+=d.total;r2.push([w,...am.map(m=>d[m]),d.total]);});
  r2.push(['Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',...am.map(m=>gt[m]),gt.total]);
  const ws2=XLSX.utils.aoa_to_sheet(r2);ws2['!cols']=[{wch:14},...am.map(()=>({wch:10})),{wch:12}];XLSX.utils.book_append_sheet(wb,ws2,'Ù…Ù„Ø®Øµ Ø¥Ø¬Ù…Ø§Ù„ÙŠ');
  const d=new Date();XLSX.writeFile(wb,`ÙˆØ±Ø´Ø©_Ø§Ù„Ø®ÙŠØ§Ø·Ø©_${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}.xlsx`);
  showToast('ØªÙ… ØªØµØ¯ÙŠØ± Excel Ø¨Ù†Ø¬Ø§Ø­ ğŸ“Š','success');
}

function exportMonthlyReport(){
  const mr=gmr(rYear,rMonth),mn=AM[rMonth]+' '+rYear;
  const wb=XLSX.utils.book_new();
  const am=[...new Set([...models,...mr.map(r=>r.model)])];
  const totalQ=mr.reduce((s,r)=>s+r.qty,0);
  const wm2={};mr.forEach(r=>wm2[r.worker]=(wm2[r.worker]||0)+r.qty);
  const kpiR=[['Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ',mn],[''],['Ø§Ù„Ù…Ø¤Ø´Ø±','Ø§Ù„Ù‚ÙŠÙ…Ø©'],['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¬Ø¨Ø¨',totalQ],['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª',mr.length],['Ø§Ù„Ù…ÙˆØ¸ÙØ§Øª Ø§Ù„Ù†Ø´Ø·Ø§Øª',new Set(mr.map(r=>r.worker)).size],['Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª',new Set(mr.map(r=>r.model)).size],['Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ù†ØªØ§Ø¬',new Set(mr.map(r=>r.date)).size],[''],['ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙØ§Øª','Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ']];
  Object.entries(wm2).sort((a,b)=>b[1]-a[1]).forEach(([w,q],i)=>kpiR.push([`${i+1}. ${w}`,q]));
  const ws1=XLSX.utils.aoa_to_sheet(kpiR);ws1['!cols']=[{wch:25},{wch:15}];XLSX.utils.book_append_sheet(wb,ws1,'Ù…Ù„Ø®Øµ Ø§Ù„Ø´Ù‡Ø±');
  const h2=['Ø§Ù„Ù…ÙˆØ¸ÙØ©',...am,'Ø£ÙŠØ§Ù… Ø¹Ù…Ù„','Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'],r2=[h2],gt2={total:0};am.forEach(m=>gt2[m]=0);
  workers.forEach(w=>{const wr=mr.filter(r=>r.worker===w);const md={};am.forEach(m=>md[m]=0);let wt=0;wr.forEach(r=>{md[r.model]+=r.qty;wt+=r.qty;});am.forEach(m=>gt2[m]+=md[m]);gt2.total+=wt;r2.push([w,...am.map(m=>md[m]),new Set(wr.map(r=>r.date)).size,wt]);});
  r2.push(['Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',...am.map(m=>gt2[m]),'',gt2.total]);
  const ws2=XLSX.utils.aoa_to_sheet(r2);ws2['!cols']=[{wch:14},...am.map(()=>({wch:10})),{wch:10},{wch:12}];XLSX.utils.book_append_sheet(wb,ws2,'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙØ§Øª');
  const r3=[['Ø§Ù„ØªØ§Ø±ÙŠØ®','Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ','Ø§Ù„Ø³Ø¬Ù„Ø§Øª'],...Object.entries((() => {const dm={};mr.forEach(r=>{if(!dm[r.date])dm[r.date]={q:0,c:0};dm[r.date].q+=r.qty;dm[r.date].c++;});return dm;})()).sort().map(([d,v])=>[d,v.q,v.c])];
  const ws3=XLSX.utils.aoa_to_sheet(r3);XLSX.utils.book_append_sheet(wb,ws3,'Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ÙŠÙˆÙ…ÙŠ');
  const r4=[['#','Ø§Ù„Ù…ÙˆØ¸ÙØ©','Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„','Ø§Ù„Ù…Ù‚Ø§Ø³','Ø§Ù„Ù„ÙˆÙ†','Ø§Ù„Ø¹Ø¯Ø¯','Ø§Ù„ØªØ§Ø±ÙŠØ®'],...mr.map((r,i)=>[i+1,r.worker,r.model,r.size,r.color,r.qty,r.date])];
  const ws4=XLSX.utils.aoa_to_sheet(r4);XLSX.utils.book_append_sheet(wb,ws4,'Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
  XLSX.writeFile(wb,`ØªÙ‚Ø±ÙŠØ±_${mn.replace(' ','_')}.xlsx`);
  showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ ğŸ“Š','success');
}

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg,type='info'){
  const t=document.getElementById('toast');t.textContent=msg;t.className=`toast show ${type}`;
  setTimeout(()=>t.classList.remove('show'),2800);
}

// Close sheets on overlay click
['recordOverlay','deleteOverlay'].forEach(id=>{
  document.getElementById(id).addEventListener('click',function(e){if(e.target===this)closeSheet(id);});
});

// INIT
renderFilterBar();applyFilters();
  if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
